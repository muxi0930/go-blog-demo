<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>æµ‹è¯• - layui</title>
	<link rel="stylesheet" href="layui/css/layui.css">
	<script src="layui/axios.min.js"></script>
</head>

<body>

	<div class="layui-container" style="margin: 30px 0 30px;">
		<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
			<legend>ğŸ‘´è€å¤´ä¹ğŸ‘´</legend>

		</fieldset>
		<button class="layui-btn layui-btn-primary layui-border-green" style="float:right" id="add_user">æ·»åŠ è€å¤´ğŸ‘´</button>
		<div class="layui-row">
			<div class="layui-col-xs12 layui-col-md8">
				<table class="layui-hide" id="user_table" , lay-filter="table_lay_filter"></table>
			</div>
			<div class="layui-col-xs6 layui-col-md4">
				<!-- <div class="layui-panel">
					<div style="padding: 50px 30px;">
					</div>
				</div> -->
			</div>
		</div>
	</div>

	<!-- å¼•å…¥ layui.js çš„ <script> æ ‡ç­¾æœ€å¥½æ”¾ç½®åœ¨ html æœ«å°¾ -->
	<script src="layui/layui.js"></script>
	<script type="text/html" id="barDemo">
		<a class="layui-btn layui-btn-xs" lay-event="check" >æŸ¥çœ‹</a>
		<!-- <a class="layui-btn layui-btn-xs" lay-event="edit">ç¼–è¾‘</a> -->
		<!-- <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">åˆ é™¤</a> -->
		<button type="button" class="layui-btn layui-btn-xs " lay-event="edit"><i class="layui-icon">î™‚</i></button>
  		<button type="button" class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del"><i class="layui-icon">î™€</i></button>
	  </script>
	<script>
		layui.use(function () {
			var layer = layui.layer
				, form = layui.form
				, laypage = layui.laypage
				, element = layui.element
				, laydate = layui.laydate
				, util = layui.util;

			//æ¬¢è¿ä¿¡æ¯
			layer.msg('Hello World');
			// // æ£€æŸ¥tokenå­˜åœ¨
			token = layui.sessionData('auth').token 
            if (token == undefined){ window.location.href = '/web/login.html'; }
		});
		layui.use('table', function () {
			var $ = layui.$
			var table = layui.table;
			table.render({
				elem: '#user_table'
				, url: '/api/v1/staffs'
				, headers: {
					'Token': layui.sessionData('auth').token
				}
				, page: { //æ”¯æŒä¼ å…¥ laypage ç»„ä»¶çš„æ‰€æœ‰å‚æ•°ï¼ˆæŸäº›å‚æ•°é™¤å¤–ï¼Œå¦‚ï¼šjump/elemï¼‰ - è¯¦è§æ–‡æ¡£
					layout: ['count', 'prev', 'page', 'next', 'skip'] //è‡ªå®šä¹‰åˆ†é¡µå¸ƒå±€ 'limit'
					//,curr: 5 //è®¾å®šåˆå§‹åœ¨ç¬¬ 5 é¡µ
					, groups: 1 //åªæ˜¾ç¤º 1 ä¸ªè¿ç»­é¡µç 
					, first: false //ä¸æ˜¾ç¤ºé¦–é¡µ
					, last: false //ä¸æ˜¾ç¤ºå°¾é¡µ
				}
				, cols: [[
					{ field: 'ID', width: 60, title: 'åºå·' }
					, { field: 'name', title: 'å§“å' }
					, { field: 'sex', width: 60, title: 'æ€§åˆ«' }
					, { fixed: 'right', title: 'æ“ä½œ', width: 160, toolbar: '#barDemo' }
				]]
			});

			// ç›‘å¬è¡Œå·¥å…·äº‹ä»¶
			table.on('tool(table_lay_filter)', function (obj) {
				var data = obj.data;
				// console.log(obj)
				if (obj.event === 'check') {
					layer.open({
						title: 'è€å¤´ä»‹ç»'
						, type: 2
						, content: 'info.html?id=' + obj.data.ID
						, area: ['100%', '500px']
					});
					//æ ‡æ³¨é€‰ä¸­æ ·å¼
					obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
				} else if (obj.event === 'del') {
					layer.confirm('çœŸçš„è¦åˆ é™¤å—ï¼Ÿ', function (index) {
						axios.delete('/api/v1/staff/' + data.ID, { headers: { 'Token': layui.sessionData('auth').token } })
							.then(function (response) {
								if (response.data.code == 200) {
									layer.msg('åˆ é™¤æˆåŠŸ', { time: 1000 }, function () {
										window.parent.location.reload();
										var index = parent.layer.getFrameIndex(window.name); //å…ˆå¾—åˆ°å½“å‰iframeå±‚çš„ç´¢å¼•
										parent.layer.close(index);
									});
								} else {
									layer.msg('åˆ é™¤å¤±è´¥ï¼', { time: 1000 }, function () {
										window.parent.location.reload();
										var index = parent.layer.getFrameIndex(window.name); //å…ˆå¾—åˆ°å½“å‰iframeå±‚çš„ç´¢å¼•
										parent.layer.close(index);
									});
								}
							})
							.catch(function (error) {
								console.log(error);
							});
					});
				} else if (obj.event === 'edit') {
					layer.open({
						title: 'ç¼–è¾‘è€å¤´'
						, type: 2
						, content: 'update.html?id=' + obj.data.ID
						, area: ['100%', '500px']
					});
				}
			});

			//add_useræŒ‰é’®è·³è½¬äº‹ä»¶
			lay('#add_user').on('click', function () {
				layer.open({
					title: 'æ·»åŠ è€å¤´'
					, type: 2
					, content: 'create.html'
					, area: ['100%', '500px']
				});
			});
		});
	</script>
</body>

</html>