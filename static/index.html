<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>测试 - layui</title>
	<link rel="stylesheet" href="layui/css/layui.css">
	<script src="layui/axios.min.js"></script>
</head>

<body>

	<div class="layui-container" style="margin: 30px 0 30px;">
		<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
			<legend>👴老头乐👴</legend>

		</fieldset>
		<button class="layui-btn layui-btn-primary layui-border-green" style="float:right" id="add_user">添加老头👴</button>
		<div class="layui-row">
			<div class="layui-col-xs12 layui-col-md8">
				<table class="layui-hide" id="user_table" , lay-filter="table_lay_filter"></table>
			</div>
			<div class="layui-col-xs6 layui-col-md4">
				<!-- <div class="layui-panel">
					<div style="padding: 50px 30px;">
					</div>
				</div> -->
			</div>
		</div>
	</div>

	<!-- 引入 layui.js 的 <script> 标签最好放置在 html 末尾 -->
	<script src="layui/layui.js"></script>
	<script type="text/html" id="barDemo">
		<a class="layui-btn layui-btn-xs" lay-event="check" >查看</a>
		<!-- <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a> -->
		<!-- <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a> -->
		<button type="button" class="layui-btn layui-btn-xs " lay-event="edit"><i class="layui-icon"></i></button>
  		<button type="button" class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del"><i class="layui-icon"></i></button>
	  </script>
	<script>
		layui.use(function () {
			var layer = layui.layer
				, form = layui.form
				, laypage = layui.laypage
				, element = layui.element
				, laydate = layui.laydate
				, util = layui.util;

			//欢迎信息
			layer.msg('Hello World');
			// // 检查token存在
			token = layui.sessionData('auth').token 
            if (token == undefined){ window.location.href = '/web/login.html'; }
		});
		layui.use('table', function () {
			var $ = layui.$
			var table = layui.table;
			table.render({
				elem: '#user_table'
				, url: '/api/v1/staffs'
				, headers: {
					'Token': layui.sessionData('auth').token
				}
				, page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
					layout: ['count', 'prev', 'page', 'next', 'skip'] //自定义分页布局 'limit'
					//,curr: 5 //设定初始在第 5 页
					, groups: 1 //只显示 1 个连续页码
					, first: false //不显示首页
					, last: false //不显示尾页
				}
				, cols: [[
					{ field: 'ID', width: 60, title: '序号' }
					, { field: 'name', title: '姓名' }
					, { field: 'sex', width: 60, title: '性别' }
					, { fixed: 'right', title: '操作', width: 160, toolbar: '#barDemo' }
				]]
			});

			// 监听行工具事件
			table.on('tool(table_lay_filter)', function (obj) {
				var data = obj.data;
				// console.log(obj)
				if (obj.event === 'check') {
					layer.open({
						title: '老头介绍'
						, type: 2
						, content: 'info.html?id=' + obj.data.ID
						, area: ['100%', '500px']
					});
					//标注选中样式
					obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
				} else if (obj.event === 'del') {
					layer.confirm('真的要删除吗？', function (index) {
						axios.delete('/api/v1/staff/' + data.ID, { headers: { 'Token': layui.sessionData('auth').token } })
							.then(function (response) {
								if (response.data.code == 200) {
									layer.msg('删除成功', { time: 1000 }, function () {
										window.parent.location.reload();
										var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
										parent.layer.close(index);
									});
								} else {
									layer.msg('删除失败！', { time: 1000 }, function () {
										window.parent.location.reload();
										var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
										parent.layer.close(index);
									});
								}
							})
							.catch(function (error) {
								console.log(error);
							});
					});
				} else if (obj.event === 'edit') {
					layer.open({
						title: '编辑老头'
						, type: 2
						, content: 'update.html?id=' + obj.data.ID
						, area: ['100%', '500px']
					});
				}
			});

			//add_user按钮跳转事件
			lay('#add_user').on('click', function () {
				layer.open({
					title: '添加老头'
					, type: 2
					, content: 'create.html'
					, area: ['100%', '500px']
				});
			});
		});
	</script>
</body>

</html>